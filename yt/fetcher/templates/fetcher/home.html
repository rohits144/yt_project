<!DOCTYPE html>
<html>
<head>
    <title>Home - YouTube Manager</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; }
        .container { max-width: 500px; margin: 5em auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 2em; text-align: center; }
        h1 { margin-bottom: 1em; }
        .btn { background: #2980b9; color: #fff; border: none; border-radius: 6px; padding: 1em 2em; font-size: 1.1em; margin: 1em 0; cursor: pointer; transition: background 0.2s; }
        .btn:hover { background: #3498db; }
    </style>
</head>
<body>
    <div class="container">
        <h1>YouTube Manager</h1>
        <form id="fetchForm" method="post" action="/fetch-subscriptions/">
            <button type="submit" class="btn">Fetch Subscriptions</button>
        </form>
        <a href="/subscriptions/" class="btn" style="display:block;text-decoration:none;">View Subscriptions</a>
        <button id="fetchFavVideosBtn" class="btn" type="button">Fetch & Download Latest Videos of Favorites</button>
    </div>
    <div id="notif" style="display:none;position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#27ae60;color:#fff;padding:0.7em 2em;border-radius:6px;z-index:2000;font-size:1.1em;box-shadow:0 2px 8px rgba(0,0,0,0.15);">Success!</div>
    <script>
        document.getElementById('fetchForm').onsubmit = function(e) {
            e.preventDefault();
            fetch('/fetch-subscriptions/', { method: 'POST' })
                .then(resp => resp.json())
                .then(data => {
                    window.location.href = '/subscriptions/';
                })
                .catch(err => {
                    alert('Failed to fetch subscriptions');
                });
        };
        document.getElementById('fetchFavVideosBtn').onclick = function() {
            var btn = this;
            btn.disabled = true;
            fetch('/fetch-download-fav-videos/', { method: 'POST' })
                .then(resp => resp.json())
                .then(data => {
                    var msg = `Downloaded: ${data.downloaded}, New Videos: ${data.new_videos}`;
                    if (data.errors && data.errors.length > 0) {
                        msg += `. Errors: ` + data.errors.map(e => e.error).join(', ');
                    }
                    showNotif(msg, data.errors.length === 0);
                })
                .catch(err => {
                    showNotif('Failed: ' + err, false);
                })
                .finally(() => { btn.disabled = false; });
        };
        function showNotif(msg, success=true) {
            var notif = document.getElementById('notif');
            notif.textContent = msg;
            notif.style.background = success ? '#27ae60' : '#c0392b';
            notif.style.display = 'block';
            setTimeout(function() { notif.style.display = 'none'; }, 3000);
        }
    </script>
</body>
</html>
